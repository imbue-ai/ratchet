# Generated by rust-bucket v0.2.0. DO NOT EDIT BY HAND.

FROM rust:1.92-bookworm

# Cache buster - increment to force rebuild: v3
ARG CACHE_BUST=3

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    ca-certificates \
    pkg-config \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

# Install cargo-nextest (required test runner per TESTING.md)
# Build from source to avoid architecture compatibility issues
RUN cargo install cargo-nextest --locked

# Install Beads task tracker (required per AGENTS.md and WORKFLOW.md)
# bd must be available on PATH
# NOTE: Beads is a Go project, NOT a Rust crate. Install via official shell script.
# Do NOT use "cargo install beads" - that installs an unrelated empty crate.
# Install Go first, then build beads from source at specific version
RUN apt-get update && apt-get install -y --no-install-recommends golang-go && rm -rf /var/lib/apt/lists/* && \
    go install github.com/steveyegge/beads/cmd/bd@v0.46.0 && \
    (command -v bd || ln -sf /root/go/bin/bd /usr/local/bin/bd 2>/dev/null || true)

# Ensure all tool binaries are on PATH
ENV PATH="/root/go/bin:/root/.local/bin:/root/.cargo/bin:${PATH}"

# Set working directory
WORKDIR /workspace

# Verify installations
RUN echo "=== Verifying installations ===" && \
    cargo --version && \
    cargo-nextest --version && \
    (bd version || echo "Warning: bd not in PATH yet, but continuing...") && \
    echo "=== All verifications complete ==="

# Default command
CMD ["bash"]
